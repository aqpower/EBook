import{d as O,u as Q,l as W,k as r,a as X,s as Y,c as k,b as Z,D as y,J as tt,_ as L,j as a,f as m,g as e,i,z as x,n as $,h as M,t as u,w as f,v as w,F as T,A as B,m as et}from"./index-09020506.js";import{b as st,d as ot,c as lt}from"./posts-93b230f2.js";import{a as R}from"./icon-da093cbc.js";import{f as nt}from"./time-b70c9257.js";import{v as at}from"./var-e8af8410.js";import{v as it,c as ct}from"./user-1668f9ec.js";const rt={key:0,class:"flex w-full h-full"},ut={class:"w-full h-full flex items-center justify-center"},dt=["src","alt"],vt={class:"flex flex-col flex-1 overflow-y-auto"},mt={class:"ml-4 mr-1"},ft={class:"flex justify-between items-center gap-1"},pt={class:"font-medium"},ht={class:"flex flex-row justify-center items-center gap-3"},_t={class:"relative"},gt={class:"absolute top-14 right-0"},bt={class:"bg-warning w-96 rounded-xl shadow-xl p-3"},xt=e("h3",{class:"text-warning-content font-bold text-lg text-center mb-4"}," 请选择违规类型 ",-1),wt={class:"flex flex-col gap-3"},Ct=["onClick"],It={class:"mt-1"},kt={class:"font-bold text-lg"},yt={class:"mt-2"},$t={class:"whitespace-pre-line"},Pt=e("div",{class:"divider"},"评论",-1),At={class:"flex gap-3"},Vt={class:"flex flex-col mt-1"},jt=["onClick"],Dt={class:"font-medium"},Lt={class:"mt-1"},Mt={class:"flex justify-end mr-5"},Tt={class:"text-xs text-slate-400"},qt=O({__name:"CardDetail",setup(Bt){var D;const c=Q(),p=W(),S=r(!0),h=r(!1),d=r(0);console.log(c);const _=X(),l=r(),P=r({}),g=r(""),b=r(!1),v=Y(L),N=(D=_.user)==null?void 0:D.id,U=c.params.postId,A=s=>{var n,o;console.log(d.value,s,(n=l.value)==null?void 0:n.url.length);let t=d.value+s;t>=0&&t<((o=l.value)==null?void 0:o.url.length)&&(d.value=t)},E=k(()=>{var t;let s=d.value-1;return s>=0&&s<((t=l.value)==null?void 0:t.url.length)}),F=k(()=>{var t;let s=d.value+1;return s>=0&&s<((t=l.value)==null?void 0:t.url.length)});Z(()=>{V()});const V=()=>{const s=c.params.postId;st(s).then(t=>{console.log(t),t.code==200?(l.value=t.data.posts,P.value=t.data.commentsList,console.log(l)):t.code==401&&v({title:"😢",content:"该帖子不存在",btnContent:"👌",onClose:()=>{p.go(-1)}})})},C=k(()=>{var s;return c.params.userId!=null&&l.value.userId==((s=_.user)==null?void 0:s.id)}),q=s=>{b.value=!1,it({userId:N,postId:U,violationReason:s}).then(n=>{n.code==200&&v({title:"🥳",content:"举报帖子成功",btnContent:"👌"})})},z=()=>{var t;let s={userId:(t=_.user)==null?void 0:t.id,postId:c.params.postId};ct(s).then(n=>{n.code==200?v({title:"🥳",content:"收藏帖子成功",btnContent:"👌"}):v({title:"🥳",content:n.msg,btnContent:"👌"})})},J=()=>{ot(c.params.postId).then(s=>{v({title:"🥳",content:"删除帖子成功",btnContent:"👌"}),p.go(-1)})},G=()=>{var t;let s={userId:(t=_.user)==null?void 0:t.id,postId:c.params.postId,content:g.value};lt(s).then(n=>{n.code==200&&(g.value="",v({title:"🥳",content:"帖子评论成功",btnContent:"👌"}),V())})},H=()=>{p.go(-1)},j=s=>{p.push(`/home/profile/${s}`).then(()=>{window.location.reload()})};return(s,t)=>(a(),y(L,{visible:S.value,"big-dialog-enable":!0},{content:tt(()=>{var n;return[l.value!=null?(a(),m("div",rt,[e("div",{class:"w-full h-full flex-1 relative",onMouseenter:t[2]||(t[2]=o=>h.value=!0),onMouseleave:t[3]||(t[3]=o=>h.value=!1)},[e("div",ut,[e("img",{class:"rounded-2xl AqImage object-cover m-auto max-w-full max-h-full",src:(n=l.value)==null?void 0:n.url[d.value],alt:l.value.title},null,8,dt)]),e("div",{class:"absolute top-1/2 left-3",onClick:t[0]||(t[0]=o=>A(-1))},[h.value&&E.value?(a(),y(i(x.Icon),{key:0,class:"w-10 h-10 p-1 text-primary bg-slate-600 rounded-full opacity-70",icon:"line-md:arrow-small-left"})):$("",!0)]),e("div",{class:"absolute top-1/2 right-3",onClick:t[1]||(t[1]=o=>A(1))},[h.value&&F.value?(a(),y(i(x.Icon),{key:0,class:"w-10 h-10 p-1 text-primary bg-slate-600 rounded-full opacity-70",icon:"line-md:arrow-small-right"})):$("",!0)])],32),e("div",vt,[e("div",mt,[e("div",ft,[e("div",{class:"flex items-center gap-2 hover:cursor-pointer",onClick:t[4]||(t[4]=o=>j(l.value.userId))},[M(i(x.Icon),{class:"w-8 h-8 m-1",icon:i(R)[l.value.avatar]},null,8,["icon"]),e("p",pt,u(l.value.name),1)]),e("div",ht,[f(e("button",{class:"btn btn-error min-h-0 h-10",onClick:J}," 删除帖子 ",512),[[w,C.value==!0]]),f(e("button",{class:"btn btn-success min-h-0 h-10",onClick:z}," 收藏 ",512),[[w,C.value==!1]]),e("div",_t,[f(e("button",{for:"vio_modal",class:"btn btn-warning min-h-0 h-10",onClick:t[5]||(t[5]=o=>b.value=!0)}," 举报 ",512),[[w,C.value==!1]]),f(e("div",gt,[e("div",bt,[xt,e("div",wt,[e("button",{for:"vio_modal",class:"btn w-full",onClick:t[6]||(t[6]=o=>b.value=!1)}," 取消 "),(a(!0),m(T,null,B(i(at),(o,I)=>(a(),m("div",{key:I},[e("button",{for:"vio_modal",class:"btn w-full",onClick:K=>q(o)},u(o),9,Ct)]))),128))])])],512),[[w,b.value==!0]])]),e("button",{class:"btn min-h-0 h-10",onClick:H},"❌")])]),e("div",It,[e("p",kt,u(l.value.title),1)]),e("div",yt,[e("p",$t,u(l.value.contentText),1)]),Pt,e("div",At,[f(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>g.value=o),class:"input w-full input-primary",placeholder:"请在这里输入评论"},null,512),[[et,g.value]]),e("button",{class:"btn btn-primary",onClick:G},"提交")]),e("div",Vt,[(a(!0),m(T,null,B(P.value,(o,I)=>(a(),m("div",{key:I,class:"flex flex-col p-3"},[e("div",{class:"flex gap-3 hover:cursor-pointer",onClick:K=>j(o.userId)},[M(i(x.Icon),{class:"w-6 h-6",icon:i(R)[o.avatar]},null,8,["icon"]),e("p",Dt,u(o.name),1)],8,jt),e("p",Lt,u(o.content),1),e("div",Mt,[e("p",Tt,u(i(nt)(o.commentTime)),1)])]))),128))])])])])):$("",!0)]}),_:1},8,["visible"]))}});export{qt as default};
